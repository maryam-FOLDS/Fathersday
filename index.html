<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"> 
    <title>Father's Day Experience</title>
    <!-- Common Scripts & Fonts -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/TextPlugin.min.js"></script> 
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;400;600&family=Pinyon+Script&family=Lato:wght@300;400&family=Caveat:wght@400;700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300;1,400&family=Dancing+Script:wght@700&family=Montserrat:wght@300;400;500;700&family=Orbitron:wght@400;700&family=Raleway:wght@300;400;600&family=Allura&family=Quattrocento+Sans:ital,wght@0,400;0,700;1,400&family=Marck+Script&family=La+Belle+Aurore&family=Nothing+You+Could+Do&family=Spectral:ital,wght@0,200;0,300;0,400;1,300&family=Parisienne&family=Charm:wght@400;700&family=Alice&display=swap" rel="stylesheet">
    
    <style>
        /* Global Reset/Base */
        body, html {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif; 
            width: 100%;
            height: 100%;
            overflow: hidden; 
        }

        .page-section {
            display: none; 
            width: 100%; 
            height: 100%; 
            position: absolute; 
            top: 0;
            left: 0;
            overflow: hidden; 
            transition: filter 0.5s ease-in-out; 
        }
        .page-section.active-page {
            display: block; 
            z-index: 1; 
        }
        .page-section:not(.active-page) {
            z-index: 0;
        }
        .page-section.blurred { 
            filter: blur(8px) brightness(0.7);
        }


        /* --- STYLES FOR THEME 1 (Nebula - FDF1.html) --- */
        #theme1Page {
            font-family: 'Montserrat', sans-serif;
            display: flex; 
            justify-content: center;
            align-items: center;
            background-color: #0a0514; 
            color: #e0e0e0; 
            width: 100%; 
            height: 100%; 
        }
        #theme1Page .nebula-canvas {
            position: relative; 
            width: 100%; 
            height: 100%; 
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
        }
        #theme1Page .real-image-backdrop {
            position: absolute; 
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://github.com/maryam-FOLDS/Fathersday/blob/main/Picsart_25-05-26_11-42-15-568.jpg?raw=true'); 
            background-size: contain; 
            background-repeat: no-repeat; 
            background-position: center;
            opacity: 0; animation: theme1_revealRealImage 3s ease-in-out 13s forwards;
            z-index: 0; 
        }
        @keyframes theme1_revealRealImage { to { opacity: 0.25; } }
        #theme1Page .stardust {
            position: absolute; border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
            opacity: 0; animation-timing-function: ease-in-out;
        }
        @keyframes theme1_fadeOutCelestial { to { opacity: 0; transform: scale(0.5); } }
        #theme1Page #star1 { width: 7px; height: 7px; top: 50%; left: 50%; 
                 animation: theme1_fadeInPulse 3s 0.5s forwards,
                            theme1_driftSlightly1 15s 0.5s linear infinite alternate,
                            theme1_fadeOutCelestial 2s ease-out 13.5s forwards;
        }
        @keyframes theme1_fadeInPulse { 
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0.7; transform: translate(-50%, -50%) scale(1); }
        }
        @keyframes theme1_driftSlightly1 { to { transform: translate(-55%, -45%) scale(1.1); } }
        #theme1Page #star2 { width: 120px; height: 120px; top: 45%; left: 48%; filter: blur(15px); 
                 background: radial-gradient(circle, rgba(200,200,255,0.1) 0%, rgba(150,150,220,0.05) 40%, transparent 70%);
                 animation: theme1_gatherCloud 5s 2s forwards, theme1_fadeOutCelestial 2s ease-out 13.5s forwards;
        }
        #theme1Page #star3 { width: 160px; height: 160px; top: 52%; left: 53%; filter: blur(25px); 
                 background: radial-gradient(circle, rgba(255,180,200,0.08) 0%, rgba(220,150,180,0.04) 40%, transparent 70%);
                 animation: theme1_gatherCloud 6s 2.5s forwards, theme1_fadeOutCelestial 2s ease-out 13.5s forwards;
        }
        @keyframes theme1_gatherCloud { 
            from { opacity: 0; transform: scale(0.2) translate(-50%, -50%); }
            to { opacity: 0.6; transform: scale(1) translate(-50%, -50%); }
        }
        #theme1Page .nebula-core {
            position: absolute; top: 50%; left: 50%; width: 50px; height: 50px; 
            border-radius: 50%;
            background: radial-gradient(circle, #FFD700 5%, #FFA500 30%, rgba(255,165,0,0.3) 60%, transparent 80%);
            opacity: 0; filter: blur(4px);
            box-shadow: 0 0 15px 4px #FFD700, 0 0 30px 8px #FFA500, 0 0 50px 15px rgba(255,165,0,0.5); 
            animation: theme1_formCoreStar 4s ease-in-out 8s forwards,
                       theme1_pulseCore 2.5s ease-in-out 12s infinite,
                       theme1_fadeOutCelestial 2s ease-out 13.5s forwards;
            transform: translate(-50%, -50%) scale(0.1);
        }
        @keyframes theme1_formCoreStar { 
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.1); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
        @keyframes theme1_pulseCore { 
            0%, 100% { transform: translate(-50%, -50%) scale(1); box-shadow: 0 0 15px 4px #FFD700, 0 0 30px 8px #FFA500, 0 0 50px 15px rgba(255,165,0,0.5); }
            50% { transform: translate(-50%, -50%) scale(1.1); box-shadow: 0 0 25px 8px #FFD700, 0 0 40px 12px #FFA500, 0 0 60px 20px rgba(255,165,0,0.6); }
        }
        #theme1Page .quote-container {
            position: relative; z-index: 10; text-align: center;
            max-width: 90vw; 
            padding: 15px;
        }
        #theme1Page .quote-segment {
            position: relative; display: block;
            font-size: clamp(1rem, 4.5vw, 1.8em); 
            line-height: 1.5; opacity: 0; margin-bottom: 0.4em;
            text-shadow: 0 0 3px rgba(224, 224, 224, 0.2), 0 0 6px rgba(200, 200, 255, 0.1);
        }
        #theme1Page .quote-segment::before { 
            content: ''; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); width: 160%; height: 180%;
            border-radius: 50%; opacity: 0; z-index: -1; 
            background: radial-gradient(circle, rgba(200, 200, 220, 0.06) 0%, rgba(200, 200, 220, 0) 70%);
            filter: blur(10px); 
        }
        #theme1Page #q4::before { 
            background: radial-gradient(circle, rgba(255, 215, 0, 0.08) 0%, rgba(255, 215, 0, 0) 70%);
            filter: blur(15px); width: 180%;
        }
        @keyframes theme1_fadeInTextGeneric { 
            from { opacity: 0; transform: translateY(15px); } 
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes theme1_fadeInBestFriend { 
            0% { opacity: 0; transform: translateY(15px); color: #e0e0e0; text-shadow: 0 0 2px rgba(224, 224, 224, 0.2); }
            60% { opacity: 1; transform: translateY(0); color: #F0E68C; text-shadow: 0 0 4px #F0E68C, 0 0 8px rgba(240,230,140,0.3); }
            100% { opacity: 1; transform: translateY(0); color: #FADA5E; text-shadow: 0 0 8px #FADA5E, 0 0 15px rgba(250,218,94,0.4), 0 0 25px rgba(250,218,94,0.2); }
        }
        #theme1Page #q1 { font-family: 'Merriweather', serif; font-weight: 300; animation: theme1_fadeInTextGeneric 2s ease-out 1.5s forwards; }
        #theme1Page #q2 { font-family: 'Montserrat', sans-serif; font-weight: 400; animation: theme1_fadeInTextGeneric 2s ease-out 4s forwards; }
        #theme1Page #q3 { font-family: 'Merriweather', serif; font-style: italic; font-weight: 300; font-size: clamp(0.9em, 4vw, 1.5em); animation: theme1_fadeInTextGeneric 2s ease-out 7s forwards; }
        #theme1Page #q4 { font-family: 'Merriweather', serif; font-weight: 700; font-size: clamp(1.5em, 6vw, 2.5em); color: #e0e0e0; animation: theme1_fadeInBestFriend 2.5s ease-out 10s forwards; }
        #theme1Page #q1::before { animation: theme1_beatLightMomentarily 1.1s ease-in-out 1.5s 2, theme1_fadeOutLight 0.8s ease-out 3.7s forwards; }
        #theme1Page #q2::before { animation: theme1_beatLightMomentarily 1.1s ease-in-out 4s 2, theme1_fadeOutLight 0.8s ease-out 6.2s forwards; }
        #theme1Page #q3::before { animation: theme1_beatLightMomentarily 1.1s ease-in-out 7s 2, theme1_fadeOutLight 0.8s ease-out 9.2s forwards; }
        #theme1Page #q4::before { animation: theme1_beatLightMomentarily 1.1s ease-in-out 10s 2, theme1_fadeOutLight 0.8s ease-out 12.2s forwards; }
        @keyframes theme1_beatLightMomentarily {0%{opacity:0.02;transform:translate(-50%,-50%) scale(.9)}50%{opacity:0.07;transform:translate(-50%,-50%) scale(1.1)}100%{opacity:0.02;transform:translate(-50%,-50%) scale(.9)}}
        @keyframes theme1_fadeOutLight {from{opacity:0.02;transform:translate(-50%,-50%) scale(.9)}to{opacity:0;transform:translate(-50%,-50%) scale(.8)}}
        /* --- END OF STYLES FOR THEME 1 --- */


        /* --- STYLES FOR THEME 2 (Constellation - FDF2.html) --- */
        #theme2Page {
            font-family: 'Lato', sans-serif; font-weight: 300;
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            background: linear-gradient(170deg, #0f0c29 0%, #302b63 60%, #24243e 100%); 
            color: #d8bfd8; padding: 1rem; 
        }
        #theme2Page .night-sky-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: -1; 
        }
        #theme2Page .star-bg-particle {
            position: absolute; background-color: rgba(255, 255, 255, 0.7); 
            border-radius: 50%; animation: theme2_subtleTwinkle 8s infinite ease-in-out; opacity: 0;
        }
        @keyframes theme2_subtleTwinkle {
            0%, 100% { opacity: var(--start-opacity, 0.1); transform: scale(0.7); }
            50% { opacity: var(--mid-opacity, 0.5); transform: scale(1); }
        }
        #theme2Page .greeting-message-area {
            text-align: center; margin-top: 2vh; 
            position: relative; z-index: 20; opacity: 0; margin-bottom: 2vh; 
        }
        #theme2Page .main-page-title { 
            font-family: 'Pinyon Script', cursive; font-size: clamp(2.5rem, 10vw, 4.5rem); 
            color: #ffe4b5; margin-bottom: 0.1em; line-height: 1.1;
            text-shadow: 0 0 12px rgba(255, 228, 181, 0.5), 0 0 20px rgba(255, 228, 181, 0.3);
            font-weight: 400; cursor: default; 
        }
        #theme2Page .main-page-title.beating-active { cursor: pointer; } 

        #theme2Page .page-subtitle {
            font-size: clamp(0.9rem, 3.5vw, 1.1rem); color: #d8bfd8; 
            letter-spacing: 0.5px; font-weight: 300; text-shadow: 0 0 8px rgba(216, 191, 216, 0.4);
        }
        #theme2Page .constellation-map { 
            position: relative; width: 85vw; max-width: 500px; 
            height: 45vh; max-height: 300px; z-index: 10; 
            display: flex; justify-content: space-around; align-items: center;
        }
        #theme2Page .memory-star-point {
            position: absolute; width: 50px; height: 50px; 
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            opacity: 0; filter: drop-shadow(0 0 8px rgba(255, 223, 186, 0.2)); 
        }
        #theme2Page .star-visual { 
            width: 18px; height: 18px; background-color: rgba(255, 223, 186, 0.6); 
            border-radius: 50%;
            box-shadow: 0 0 8px 2px rgba(255, 223, 186, 0.6), 0 0 15px 6px rgba(255, 223, 186, 0.2);
            animation: theme2_memoryStarPulse 3s infinite ease-in-out;
            transition: transform 0.4s ease, box-shadow 0.4s ease;
        }
        #theme2Page #star-m2022 { top: 30%; left: 25%; } 
        #theme2Page #star-m2025 { top: 60%; left: 75%; }

        @keyframes theme2_memoryStarPulse{0%,100%{transform:scale(.9);opacity:.7}50%{transform:scale(1.1);opacity:1}}#theme2Page .memory-star-point:hover .star-visual{transform:scale(1.3);box-shadow:0 0 15px 5px rgba(255,223,186,.6),0 0 30px 12px rgba(255,223,186,.2)}#theme2Page .memory-star-point.ignited .star-visual{transform:scale(2.5)!important;background-color:rgba(255,245,220,.9)!important;box-shadow:0 0 25px 10px rgba(255,245,220,.9),0 0 50px 20px rgba(255,223,186,.2)!important;opacity:1!important;animation:none}#theme2Page .star-year-label{position:absolute;bottom:-20px;left:50%;transform:translateX(-50%);font-size:.8rem;color:#e0e0e0;opacity:.7;text-shadow:0 0 5px rgba(224,224,224,.5)}#theme2Page .memory-reveal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(10,5,25,.6);backdrop-filter:blur(10px) brightness(.7);display:flex;justify-content:center;align-items:center;z-index:2000;opacity:0;pointer-events:none;transition:opacity .5s ease-in-out}#theme2Page .memory-reveal-content{position:relative;max-width:90vw;max-height:85vh;width:auto;padding:8px;opacity:0;transform:scale(.8);display:flex;flex-direction:column;align-items:center}#theme2Page .memory-reveal-overlay.visible{opacity:1;pointer-events:all}#theme2Page .revealed-image-container{border-radius:8px;overflow:hidden;box-shadow:0 0 30px 12px rgba(255,223,186,.2),0 0 50px 20px rgba(255,255,255,.1);background-color:rgba(0,0,0,.2);margin-bottom:1rem}#theme2Page .revealed-image{display:block;max-width:85vw;max-height:65vh;width:auto;height:auto;object-fit:contain;border-radius:6px}#theme2Page .revealed-caption{text-align:center;font-size:clamp(1rem,4vw,1.2rem);color:#f0f8ff;line-height:1.5;max-width:90%;text-shadow:0 0 8px rgba(240,248,255,.5)}#theme2Page .close-reveal-button{position:absolute;top:0;right:0;font-size:2rem;color:#d8bfd8;background:0 0;border:none;cursor:pointer;padding:.5rem;line-height:1;opacity:.7;transition:opacity .3s,transform .3s,color .3s;z-index:101;text-shadow:0 0 5px #0f0c29}#theme2Page .close-reveal-button:hover{opacity:1;transform:scale(1.15) rotate(90deg);color:#fff}
        /* --- END OF STYLES FOR THEME 2 --- */


        /* --- STYLES FOR THEME 3 (Single Clickable Circle) --- */
        #theme3Page {
            font-family: 'Poppins', sans-serif; background-color: #f4f0e8; color: #795548; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 1rem; 
            box-sizing: border-box; 
        }
        #theme3Page .title-container { 
            text-align: center; margin-bottom: 2rem; 
            opacity: 0; transform: translateY(-20px); 
            width: 90%; 
            max-width: 600px; 
        }
        #theme3Page .main-title {
            font-family: 'Great Vibes', cursive; font-size: clamp(2.2rem, 9vw, 3.5rem); 
            color: #5d4037; margin-bottom: 0.2rem;
        }
        #theme3Page .sub-title { font-size: clamp(0.8rem, 3vw, 1rem); font-weight: 300; } 
        
        #theme3ClickableCircle { 
            width: clamp(160px, 45vw, 220px); 
            height: clamp(160px, 45vw, 220px);
            border-radius: 50%;
            background-color: #e57373; 
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: clamp(0.9rem, 4.5vw, 1.4rem); 
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            padding: 15px; 
            box-sizing: border-box;
            cursor: pointer;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            filter: drop-shadow(0 4px 12px rgba(0,0,0,0.15));
            opacity: 0; 
            transform: scale(0.8); 
            line-height: 1.3;
        }
        #theme3ClickableCircle:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 18px rgba(0,0,0,0.2);
        }

        #theme3Page .video-modal{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(50,30,30,.8);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:center;z-index:2000;opacity:0;pointer-events:none;transition:opacity .4s ease-in-out}#theme3Page .video-modal.active{opacity:1;pointer-events:all}#theme3Page .video-modal-content{position:relative;width:95vw;height:auto;max-width:1000px;max-height:90vh;background-color:#000;box-shadow:0 0 40px rgba(0,0,0,.5);border-radius:8px;overflow:hidden;transform:scale(.8);opacity:0}#theme3Page .video-modal-content video{display:block;width:100%;height:100%;max-height:90vh;object-fit:contain}#theme3Page .close-modal-btn{position:absolute;top:10px;right:10px;font-size:1.8rem;color:rgba(255,255,255,.7);background:0 0;border:none;cursor:pointer;z-index:10;transition:color .3s,transform .3s}#theme3Page .close-modal-btn:hover{color:#fff;transform:scale(1.1)}
        /* --- END OF STYLES FOR THEME 3 --- */

        #finalPopup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background-color: rgba(40, 30, 50, 0.85); 
            color: #f0f0f0;
            padding: 30px 40px;
            border-radius: 12px;
            text-align: center;
            z-index: 3000; 
            opacity: 0;
            pointer-events: none; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            font-family: 'Merriweather', serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.8em;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; 
        }
        #finalPopup.visible {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: all;
        }
        #finalPopup p {
            margin: 0;
            line-height: 1.6;
        }
        #finalPopup .popup-date {
            font-size: clamp(1.2rem, 5vw, 1.8rem);
            font-weight: 700;
            color: #FFD700; 
        }
        #finalPopup .popup-from {
            font-size: clamp(1rem, 4vw, 1.5rem);
            font-style: italic;
        }
        #finalPopup .popup-madeby {
            font-size: clamp(0.8rem, 3vw, 1rem);
            opacity: 0.8;
            margin-top: 0.5em;
        }


        #backgroundMusic {
            position: fixed;
            bottom: 10px;
            left: 10px;
            opacity: 0.5; 
            z-index: 9999;
            /* display: none !important; */ 
        }

    </style>
</head>
<body>
    
    <audio id="backgroundMusic" loop preload="auto"> 
        <source src="https://github.com/maryam-FOLDS/Fathersday/raw/main/128-Te%20Amo%20-%20Dum%20Maaro%20Dum%20128%20Kbps.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- Page 1: Nebula Quote (FDF1.html) -->
    <div class="page-section active-page" id="theme1Page">
        <div class="nebula-canvas">
            <div class="stardust" id="star1"></div>
            <div class="stardust" id="star2"></div>
            <div class="stardust" id="star3"></div>
            <div class="nebula-core"></div>
            <div class="real-image-backdrop"></div> 
            <div class="quote-container">
                <p class="quote-segment" id="q1">“From the first steps</p>
                <p class="quote-segment" id="q2">to our deepest talks,”</p>
                <p class="quote-segment" id="q3">— your journey from Father</p>
                <p class="quote-segment" id="q4">to Best Friend.</p>
            </div>
        </div>
    </div>

    <!-- Page 2: Constellation of Moments (FDF2.html) -->
    <div class="page-section" id="theme2Page">
        <div class="night-sky-canvas" id="theme2NightSky"></div>
        <div class="greeting-message-area">
            <h1 class="main-page-title" id="theme2MainTitle">Happy Father's Day</h1>
            <p class="page-subtitle">Our memories, shining by your light.</p>
        </div>
        <div class="constellation-map">
            <div class="memory-star-point" id="star-m2022" data-milestone-id="m2022_theme2">
                <div class="star-visual"></div><span class="star-year-label">2022</span>
            </div>
            <div class="memory-star-point" id="star-m2025" data-milestone-id="m2025_theme2">
                <div class="star-visual"></div><span class="star-year-label">2025</span>
            </div>
        </div>
        <div class="memory-reveal-overlay" id="memoryRevealOverlay_theme2">
            <div class="memory-reveal-content">
                <button class="close-reveal-button" aria-label="Close memory view">&times;</button>
                <div class="revealed-image-container">
                    <img src="" alt="A shining memory" id="revealedImageDisplay_theme2" class="revealed-image">
                </div>
                <p id="revealedCaptionDisplay_theme2" class="revealed-caption"></p>
            </div>
        </div>
    </div>

    <!-- Page 3: Single Clickable Circle -->
    <div class="page-section" id="theme3Page">
        <div class="title-container">
            <h1 class="main-title">Words I Never Said</h1> 
            <p class="sub-title">A special message, just for you, Dad</p> 
        </div>
        <div id="theme3ClickableCircle" data-video-src="https://github.com/maryam-FOLDS/Fathersday/raw/main/VID-20250526-WA0002.mp4">
            Click Here Dad
        </div>
        
        <div class="video-modal" id="videoModal_theme3">
            <div class="video-modal-content">
                <video id="fullScreenVideoPlayer_theme3" controls controlsList="nodownload"></video>
                <button class="close-modal-btn" id="closeModalButton_theme3">&times;</button>
            </div>
        </div>
    </div>

    <div id="finalPopup">
        <p class="popup-date">15-06-2025</p>
        <p class="popup-from">From Ridhi</p>
        <p class="popup-madeby">Made by MARYAM</p>
    </div>


    <script>
        const allPages = document.querySelectorAll(".page-section");
        let theme1CompletionTimeout = null; 
        let theme2TitleBeatingAnimation = null; 
        const backgroundMusic = document.getElementById('backgroundMusic'); 
        let musicStartTimeout = null; 
        let hasMusicPlayedFrom28s = false;
        const DEFAULT_MUSIC_VOLUME = 0.5; 
        const DUCKED_MUSIC_VOLUME = 0.05;
        const finalPopup = document.getElementById('finalPopup');

        function actuallyPlayMusic() { // Helper function to avoid repeating play logic
            if (backgroundMusic.paused) { // Check if still paused
                backgroundMusic.volume = DEFAULT_MUSIC_VOLUME;
                let playPromise = backgroundMusic.play();
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                        console.log("Background music play successful. Current time:", backgroundMusic.currentTime);
                        // Mark as played from 28s if it indeed started at/after that point
                        if (backgroundMusic.currentTime >= 27.5) { // Using 27.5 for a small tolerance
                            hasMusicPlayedFrom28s = true;
                            console.log("hasMusicPlayedFrom28s set to true.");
                        }
                    }).catch(error => {
                        console.warn("Background music play was blocked/failed:", error);
                    });
                }
            }
        }

        function attemptPlayBackgroundMusic(isTheme1InitialStart = false) {
            if (backgroundMusic) {
                if (backgroundMusic.paused) {
                    if ((isTheme1InitialStart && !hasMusicPlayedFrom28s) || !hasMusicPlayedFrom28s) {
                        try {
                            if (backgroundMusic.readyState >= 1) { // HAVE_METADATA or more
                                backgroundMusic.currentTime = 28;
                                console.log("Music currentTime set to 28s. ReadyState:", backgroundMusic.readyState);
                                actuallyPlayMusic();
                            } else {
                                const setTimeAndPlayOnceReady = () => {
                                    if (!hasMusicPlayedFrom28s) { 
                                        backgroundMusic.currentTime = 28;
                                        console.log("Music currentTime set to 28s after metadata loaded.");
                                    }
                                    actuallyPlayMusic();
                                    // Clean up listeners to prevent multiple calls
                                    backgroundMusic.removeEventListener('canplay', setTimeAndPlayOnceReady);
                                    backgroundMusic.removeEventListener('loadedmetadata', setTimeAndPlayOnceReady);
                                };
                                backgroundMusic.addEventListener('canplay', setTimeAndPlayOnceReady, { once: true });
                                backgroundMusic.addEventListener('loadedmetadata', setTimeAndPlayOnceReady, { once: true });
                                console.log("Audio not ready to set currentTime, waiting for metadata. ReadyState:", backgroundMusic.readyState);
                                return; 
                            }
                        } catch (e) {
                            console.error("Error setting currentTime:", e);
                            actuallyPlayMusic(); // Try to play anyway if setting currentTime failed
                        }
                    } else {
                        actuallyPlayMusic(); // If hasMusicPlayedFrom28s is true, just play from current position
                    }
                } else { // Music is already playing
                    if (backgroundMusic.volume < DEFAULT_MUSIC_VOLUME &&
                        (!theme3VideoModal || !theme3VideoModal.classList.contains('active'))) {
                        gsap.to(backgroundMusic, { volume: DEFAULT_MUSIC_VOLUME, duration: 0.3 });
                    }
                    if (backgroundMusic.currentTime >= 27.5) {
                        hasMusicPlayedFrom28s = true;
                    }
                    console.log("Background music is already playing.");
                }
            }
        }


        function addInteractionListenerForMusic() {
            const enableAudioOnInteraction = () => {
                console.log("User interaction detected.");
                if (backgroundMusic && backgroundMusic.paused) {
                    console.log("Attempting to play music due to interaction.");
                    attemptPlayBackgroundMusic(false); 
                }
            };
            document.body.addEventListener('click', enableAudioOnInteraction, { once: true, capture: true });
            document.body.addEventListener('touchstart', enableAudioOnInteraction, { once: true, capture: true });
            console.log("Global interaction listener for music added.");
        }


        function showPage(pageId) {
            document.querySelectorAll('video:not(#fullScreenVideoPlayer_theme3):not(#backgroundMusic)').forEach(vid => vid.pause()); 
            
            clearTimeout(theme1CompletionTimeout);
            clearTimeout(musicStartTimeout); 

            if (theme2TitleBeatingAnimation) {
                theme2TitleBeatingAnimation.kill();
                theme2TitleBeatingAnimation = null;
                const theme2MainTitleEl = document.getElementById('theme2MainTitle'); 
                if(theme2MainTitleEl) {
                    theme2MainTitleEl.classList.remove('beating-active');
                    theme2MainTitleEl.removeEventListener('click', handleTheme2TitleClick);
                    gsap.to(theme2MainTitleEl, {clearProps: "transform,textShadow,cursor"}); 
                }
            }

            let pageToShow = null;
            allPages.forEach(page => {
                const pageIsActive = page.id === pageId;
                if (pageIsActive) {
                    pageToShow = page;
                } else {
                    if (page.classList.contains('active-page')) {
                        gsap.to(page, {opacity:0, duration:0.5, ease:"power2.in", onComplete: () => {
                            page.classList.remove('active-page');
                        }});
                    } else {
                         page.classList.remove('active-page'); 
                         gsap.set(page, {opacity:0}); 
                    }
                }
            });

            if(pageToShow){
                if (!pageToShow.classList.contains('active-page')) {
                    pageToShow.classList.add('active-page');
                    gsap.fromTo(pageToShow, {opacity:0, scale:0.97}, {opacity:1, scale:1, duration:0.7, ease:"power2.out", 
                        onComplete: () => { // When page is fully visible
                            if (pageId === 'theme1Page') {
                                console.log("Theme 1 fully visible, attempting initial music play.");
                                attemptPlayBackgroundMusic(true); 
                            }
                        }
                    });
                } else { // If page was already active (e.g. on initial load)
                     if (pageId === 'theme1Page') {
                        // For initial load, if page is already active, attempt music play.
                        // A small delay to ensure everything is set.
                        musicStartTimeout = setTimeout(() => {
                            console.log("Theme 1 initial load, attempting music play.");
                            attemptPlayBackgroundMusic(true);
                        }, 50); 
                    }
                }
                
                if (pageId === 'theme1Page') {
                     startTheme1Sequence(); 
                } else {
                    if (backgroundMusic && backgroundMusic.paused) {
                        attemptPlayBackgroundMusic(false); 
                    }
                }
                
                if (pageId === 'theme2Page') {
                    if (!pageToShow.classList.contains('animations-initialized-theme2')) {
                        initTheme2Animations();
                        pageToShow.classList.add('animations-initialized-theme2');
                    }
                } else if (pageId === 'theme3Page') {
                     if (!pageToShow.classList.contains('animations-initialized-theme3')) {
                        initTheme3Animations(); 
                        pageToShow.classList.add('animations-initialized-theme3');
                    }
                }
            }
        }

        function startTheme1Sequence() {
            console.log("Theme 1 sequence (re)started.");
            clearTimeout(theme1CompletionTimeout); 
            const theme1Page = document.getElementById('theme1Page');
            
            if (theme1Page && theme1Page.classList.contains('active-page')) {
                const nebulaCanvas = theme1Page.querySelector('.nebula-canvas');
                if(nebulaCanvas){ 
                    const elementsToRestart = nebulaCanvas.querySelectorAll('.stardust, .nebula-core, .real-image-backdrop, .quote-segment, .quote-segment::before');
                    elementsToRestart.forEach(el => {
                        const currentAnimation = window.getComputedStyle(el).animationName;
                        if (currentAnimation && currentAnimation !== 'none') {
                            el.style.animation = 'none'; 
                            el.offsetHeight; 
                            el.style.animation = ''; 
                        }
                    });
                }
            }

            theme1CompletionTimeout = setTimeout(() => {
                const activePage = document.querySelector('.page-section.active-page');
                if (activePage && activePage.id === 'theme1Page') {
                    gsap.to("#theme1Page", {
                        opacity: 0, duration: 0.8, ease: "power2.in",
                        onComplete: () => { showPage('theme2Page'); }
                    });
                }
            }, 16000); 
        }
        
        const theme2Memories = { 
            m2022_theme2: { image: "https://github.com/maryam-FOLDS/Fathersday/blob/main/IMG-20250526-WA0000.jpg?raw=true", caption: "A cherished memory from 2022." },
            m2025_theme2: { image: "https://github.com/maryam-FOLDS/Fathersday/blob/main/IMG-20250525-WA0029.jpg?raw=true", caption: "My amazing father, today and always." } 
        };
        const theme2SkyCanvas = document.getElementById('theme2NightSky');
        const theme2GreetingArea = document.querySelector('#theme2Page .greeting-message-area');
        const theme2MainTitleEl = document.getElementById('theme2MainTitle');  
        const theme2MemoryStarPoints = document.querySelectorAll('#theme2Page .memory-star-point');
        const theme2RevealOverlay = document.getElementById('memoryRevealOverlay_theme2');
        const theme2RevealContent = theme2RevealOverlay ? theme2RevealOverlay.querySelector('.memory-reveal-content') : null;
        const theme2RevealedImage = document.getElementById('revealedImageDisplay_theme2');
        const theme2RevealedCaption = document.getElementById('revealedCaptionDisplay_theme2');
        const theme2CloseRevealBtn = theme2RevealOverlay ? theme2RevealOverlay.querySelector('.close-reveal-button') : null;
        let theme2CurrentOpenMilestoneId = null;
        let theme2IsAnimatingModal = false;

        function theme2_createStarBackground() { 
            if (!theme2SkyCanvas || theme2SkyCanvas.classList.contains('stars-created')) return;
            theme2SkyCanvas.innerHTML = '';
            const numStars = 150; 
            for (let i = 0; i < numStars; i++) {
                const star = document.createElement('div');
                star.className = 'star-bg-particle'; 
                const size = Math.random() * 1.2 + 0.2; 
                star.style.width = `${size}px`; star.style.height = `${size}px`;
                star.style.left = `${Math.random() * 100}%`; star.style.top = `${Math.random() * 100}%`;
                star.style.setProperty('--start-opacity', (Math.random() * 0.2 + 0.05).toFixed(2));
                star.style.setProperty('--mid-opacity', (Math.random() * 0.3 + 0.2).toFixed(2)); 
                star.style.animationDelay = `${Math.random() * 8}s`;
                star.style.animationDuration = `${Math.random() * 6 + 4}s`;
                theme2SkyCanvas.appendChild(star);
            }
            theme2SkyCanvas.classList.add('stars-created');
        }
        
        function theme2_showMemory(milestoneId) { 
            if (!theme2Memories[milestoneId] || theme2IsAnimatingModal || theme2CurrentOpenMilestoneId === milestoneId) return;
            if(theme2CurrentOpenMilestoneId) { theme2_closeMemory(() => theme2_showMemory(milestoneId)); return; }
            theme2IsAnimatingModal = true; theme2CurrentOpenMilestoneId = milestoneId;
            const data = theme2Memories[milestoneId];
            const starElement = document.querySelector(`#theme2Page #star-${milestoneId.replace('_theme2','')}`); 
            if(theme2RevealedImage) theme2RevealedImage.src = data.image; 
            if(theme2RevealedCaption) theme2RevealedCaption.textContent = data.caption;
            gsap.killTweensOf([theme2RevealOverlay, theme2RevealContent]);
            if(theme2MemoryStarPoints) theme2MemoryStarPoints.forEach(s => s.classList.remove('ignited'));
            if(starElement) starElement.classList.add('ignited');
            if(theme2RevealOverlay) theme2RevealOverlay.classList.add('visible');
            if(theme2RevealOverlay) gsap.to(theme2RevealOverlay, { opacity: 1, duration: 0.5, ease: "power2.out" }); 
            if(theme2RevealContent) {
                gsap.fromTo(theme2RevealContent, 
                    { opacity: 0, scale: 0.75, y: 15, filter: "blur(4px)" },
                    { opacity: 1, scale: 1, y: 0, filter: "blur(0px)", duration: 0.6, ease: "back.out(1.2)", delay: 0.1, 
                      onComplete: () => theme2IsAnimatingModal = false
                    }
                );
            } else { theme2IsAnimatingModal = false; }
        }
        
        function theme2_closeMemory(onCompleteCallback) { 
            if (!theme2CurrentOpenMilestoneId || theme2IsAnimatingModal) { if (typeof onCompleteCallback === 'function') onCompleteCallback(); return; }
            theme2IsAnimatingModal = true;
            const wasLastMilestone = theme2CurrentOpenMilestoneId === 'm2025_theme2'; 
            const starElement = document.querySelector(`#theme2Page #star-${theme2CurrentOpenMilestoneId.replace('_theme2','')}`);
            if(starElement) starElement.classList.remove('ignited');
            gsap.killTweensOf([theme2RevealOverlay, theme2RevealContent]);
            if(theme2RevealContent) {
                gsap.to(theme2RevealContent, { 
                    opacity: 0, scale: 0.8, y: 10, filter: "blur(2px)", duration: 0.3, ease: "power2.in", 
                    onComplete: () => {
                        if(theme2RevealOverlay) theme2RevealOverlay.classList.remove('visible');
                        theme2CurrentOpenMilestoneId = null; theme2IsAnimatingModal = false;
                        if (wasLastMilestone) activateTheme2TitleBeating();
                        if (typeof onCompleteCallback === 'function') onCompleteCallback();
                    }
                });
            } else { 
                 if(theme2RevealOverlay) theme2RevealOverlay.classList.remove('visible');
                 theme2CurrentOpenMilestoneId = null; theme2IsAnimatingModal = false;
                 if (wasLastMilestone) activateTheme2TitleBeating();
                 if (typeof onCompleteCallback === 'function') onCompleteCallback();
            }
            if(theme2RevealOverlay) gsap.to(theme2RevealOverlay, { opacity: 0, duration: 0.4, ease: "power2.inOut", delay: 0.05 }); 
        }

        function activateTheme2TitleBeating() {
            const titleEl = document.getElementById('theme2MainTitle'); 
            if (titleEl && !titleEl.classList.contains('beating-active')) {
                titleEl.classList.add('beating-active');
                theme2TitleBeatingAnimation = gsap.to(titleEl, {
                    scale: 1.08, 
                    textShadow: "0 0 20px rgba(255, 228, 181, 0.8), 0 0 40px rgba(255, 228, 181, 0.6)", 
                    duration: 0.6, repeat: -1, yoyo: true, ease: "sine.inOut" 
                });
                titleEl.addEventListener('click', handleTheme2TitleClick);
            }
        }

        function handleTheme2TitleClick() {
            const titleEl = document.getElementById('theme2MainTitle');
            if (theme2TitleBeatingAnimation) theme2TitleBeatingAnimation.kill(); 
            if(titleEl) {
                titleEl.classList.remove('beating-active');
                titleEl.removeEventListener('click', handleTheme2TitleClick);
                gsap.to(titleEl, {clearProps: "transform,textShadow,cursor"}); 
            }
            gsap.to("#theme2Page", {
                opacity: 0, duration: 0.8, ease: "power2.in",
                onComplete: () => { showPage('theme3Page'); }
            });
        }

        function initTheme2Animations() { 
            theme2_createStarBackground(); 
            const introTl = gsap.timeline({ delay: 0.2 }); 
            if(theme2GreetingArea) { 
                introTl.fromTo(theme2GreetingArea, { opacity: 0, y: -20, scale: 0.95 }, { opacity: 1, y: 0, scale: 1, duration: 1, ease: "power3.out" }); 
            }
            if(theme2MemoryStarPoints.length > 0) {
                theme2MemoryStarPoints.forEach((star, index) => {
                    introTl.fromTo(star, { opacity: 0, scale: 0.5, y: 15 }, { opacity: 1, scale: 1, y: 0, duration: 0.8, ease: "back.out(1.4)", delay: index * 0.15 }, "-=0.7" ); 
                });
            }
        }
        if (theme2MemoryStarPoints.length > 0) { theme2MemoryStarPoints.forEach(star => { star.addEventListener('click', () => { theme2_showMemory(star.dataset.milestoneId); }); }); }
        if (theme2CloseRevealBtn) theme2CloseRevealBtn.addEventListener('click', () => theme2_closeMemory());
        if (theme2RevealOverlay) { theme2RevealOverlay.addEventListener('click', (event) => { if (event.target === theme2RevealOverlay) theme2_closeMemory(); }); }
        // --- END SCRIPT FOR THEME 2 ---

        // --- SCRIPT FOR THEME 3 (Single Clickable Circle) ---
        const theme3TitleContainer = document.querySelector("#theme3Page .title-container");
        const theme3ClickableCircle = document.getElementById("theme3ClickableCircle"); 
        const theme3VideoModal = document.getElementById("videoModal_theme3");
        const theme3VideoModalContent = theme3VideoModal ? theme3VideoModal.querySelector(".video-modal-content") : null;
        const theme3FullScreenVideoPlayer = document.getElementById("fullScreenVideoPlayer_theme3");
        const theme3CloseModalButton = document.getElementById("closeModalButton_theme3");

        function initTheme3Animations() { 
            if(theme3TitleContainer) gsap.fromTo(theme3TitleContainer, {opacity:0, y:-20}, { opacity: 1, y: 0, duration: 0.8, ease: "power3.out", delay: 0.2 }); 
            if(theme3ClickableCircle) gsap.fromTo(theme3ClickableCircle, {opacity:0, scale:0.85}, { opacity: 1, scale: 1, duration: 1, ease: "elastic.out(1, 0.6)", delay: 0.4 }); 
        }
        
        function theme3_triggerVideoPlayback(videoSrc) { 
            if (!theme3FullScreenVideoPlayer || !theme3VideoModal || (theme3FullScreenVideoPlayer.src && !theme3FullScreenVideoPlayer.paused)) {
                return; 
            }

            if (backgroundMusic && !backgroundMusic.paused) {
                gsap.to(backgroundMusic, {volume: DUCKED_MUSIC_VOLUME, duration: 0.5});
            }
            theme3FullScreenVideoPlayer.volume = 1.0; 

            theme3FullScreenVideoPlayer.src = videoSrc;
            theme3FullScreenVideoPlayer.load();
            theme3VideoModal.classList.add('active');

            if (theme3VideoModalContent) {
                gsap.fromTo(theme3VideoModalContent,
                    { scale: 0.75, opacity: 0, y: 10 },
                    {
                        scale: 1, opacity: 1, y: 0, duration: 0.4, ease: "power2.out",
                        onComplete: () => {
                            theme3FullScreenVideoPlayer.play().catch(e => console.warn("Theme 3 video play failed:", e));
                        }
                    });
            } else { 
                 theme3FullScreenVideoPlayer.play().catch(e => console.warn("Theme 3 video play failed (no content anim):", e));
            }
        }

        if (theme3ClickableCircle) { 
            theme3ClickableCircle.addEventListener('click', () => { 
                if (theme3VideoModal && theme3VideoModal.classList.contains('active') && theme3FullScreenVideoPlayer && !theme3FullScreenVideoPlayer.paused) {
                    return;
                }
                const videoSrc = theme3ClickableCircle.dataset.videoSrc; 
                theme3_triggerVideoPlayback(videoSrc);
            }); 
        }
        
        function theme3_closeVideoModal(showFinalPopupAfter = false) { 
            if(theme3FullScreenVideoPlayer) theme3FullScreenVideoPlayer.pause();
            
            if (backgroundMusic) {
                gsap.to(backgroundMusic, {volume: DEFAULT_MUSIC_VOLUME, duration: 0.5});
            }

            if(theme3VideoModalContent && theme3VideoModal) {
                gsap.to(theme3VideoModalContent, { 
                    scale: 0.75, opacity: 0, y:10, duration: 0.3, ease: "power2.in", 
                    onComplete: () => { 
                        theme3VideoModal.classList.remove('active'); 
                        if(theme3FullScreenVideoPlayer) theme3FullScreenVideoPlayer.src = ""; 
                        if (showFinalPopupAfter) { 
                            triggerFinalPopup();
                        }
                    }});
            } else if (theme3VideoModal) { 
                theme3VideoModal.classList.remove('active'); 
                if(theme3FullScreenVideoPlayer) theme3FullScreenVideoPlayer.src = ""; 
                if (showFinalPopupAfter) {
                    triggerFinalPopup();
                }
            }
        }

        function triggerFinalPopup() {
            const theme3PageEl = document.getElementById('theme3Page');
            if (theme3PageEl) {
                theme3PageEl.classList.add('blurred');
            }
            if (finalPopup) {
                gsap.to(finalPopup, {
                    opacity: 1, 
                    scale: 1, 
                    duration: 0.6, 
                    ease: "back.out(1.7)",
                    onStart: () => finalPopup.classList.add('visible')
                });
            }
        }


        if(theme3CloseModalButton) theme3CloseModalButton.addEventListener('click', () => theme3_closeVideoModal(false) ); 
        if(theme3VideoModal) { theme3VideoModal.addEventListener('click', (event) => { if (event.target === theme3VideoModal) theme3_closeVideoModal(false); });} 
        
        if(theme3FullScreenVideoPlayer) { 
            theme3FullScreenVideoPlayer.addEventListener('ended', () => { 
                theme3_closeVideoModal(true); 
            });
            theme3FullScreenVideoPlayer.addEventListener('pause', () => {
                if (theme3VideoModal.classList.contains('active') && !theme3FullScreenVideoPlayer.ended) {
                    if (backgroundMusic) {
                        gsap.to(backgroundMusic, {volume: DEFAULT_MUSIC_VOLUME, duration: 0.3});
                    }
                }
            });
             theme3FullScreenVideoPlayer.addEventListener('play', () => {
                if (theme3VideoModal.classList.contains('active')) {
                     if (backgroundMusic && !backgroundMusic.paused) {
                        gsap.to(backgroundMusic, {volume: DUCKED_MUSIC_VOLUME, duration: 0.3});
                    }
                }
            });
        }
        // --- END SCRIPT FOR THEME 3 ---

        // Global Event Listeners & Initial Setup
        document.addEventListener('DOMContentLoaded', () => {
            backgroundMusic.volume = DEFAULT_MUSIC_VOLUME; 
            const defaultPageId = 'theme1Page'; 
            showPage(defaultPageId); 
            addInteractionListenerForMusic(); 
        });

        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape") {
               const activeTheme2Modal = document.getElementById('memoryRevealOverlay_theme2');
               const activeTheme3Modal = document.getElementById('videoModal_theme3');
               if (activeTheme2Modal && activeTheme2Modal.classList.contains('visible')) {
                   theme2_closeMemory();
               }
               if (activeTheme3Modal && activeTheme3Modal.classList.contains('active')) {
                   theme3_closeVideoModal(false); 
               }
            }
        });
    </script>
</body>
</html>
